<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:p="http://primefaces.org/ui"
    xmlns:c="http://java.sun.com/jsp/jstl/core">
    <div class="chat">
	    <div id="messages" class="messages">
			<h:form id="chatMsgForm">
				<p:outputPanel id="msgs" layout="block"/>
			</h:form>
			<p:socket onMessage="handleMessage" channel="room/#{roomName}" />
		</div>
		<c:if test="#{roomName != 'help'}">
			<div class="messageBox">
				<h:form>
					<h:inputText id="message" styleClass="box" value="#{messageBean.message}" pt:placeholder="Message"/>
					<h:commandButton value="send" action="#{userBean.sendMessage(messageBean.message)}"/>
				</h:form>
			</div>
		</c:if>
	</div>
	<script type="text/javascript">
		function handleMessage(message) {
			var chatContent = $(PrimeFaces.escapeClientId('chatMsgForm:public')), text = message;
			chatContent.append(text + '<br />');
		}
	</script>
</ui:composition>